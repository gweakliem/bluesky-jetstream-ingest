version: '3.8'

services:
  # Jetstream ingestion service
  ingestor:
    build: .
    container_name: jetstream-ingestor
    volumes:
      # Mount data directory for DuckDB database persistence
      - ./data:/data
      # Mount source code for development (hot-reload)
      - ./jetstream_ingestion:/app/jetstream_ingestion
    environment:
      - PYTHONUNBUFFERED=1
    command: jetstream-ingest /data/jetstream.db --batch-size 1000
    restart: unless-stopped
    networks:
      - jetstream-net

  # DuckDB CLI service for querying the database
  duckdb-cli:
    build: .
    container_name: duckdb-cli
    volumes:
      - ./data:/data
    working_dir: /data
    entrypoint: ["bash","-c","/root/.duckdb/cli/latest/duckdb -readonly /data/jetstream.db"]
    profiles:
      - tools
    networks:
      - jetstream-net

networks:
  jetstream-net:
    driver: bridge

volumes:
  data:
